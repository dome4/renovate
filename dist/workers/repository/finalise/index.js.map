{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../lib/workers/repository/finalise/index.ts"],"names":[],"mappings":";;;;AACA,4CAAyC;AACzC,wDAAqD;AACrD,wFAAkE;AAClE,2CAAsD;AACtD,oDAAgD;AAChD,mCAA6C;AAC7C,mEAA+D;AAE/D,uBAAuB;AAChB,KAAK,UAAU,YAAY,CAChC,MAAsB,EACtB,UAAoB;IAEpB,MAAM,eAAe,CAAC,SAAS,EAAE,CAAC;IAClC,MAAM,IAAA,0BAAkB,EAAC,MAAM,EAAE,UAAU,CAAC,CAAC;IAC7C,MAAM,mBAAQ,CAAC,kBAAkB,CAC/B,6CAA6C,CAC9C,CAAC;IACF,MAAM,IAAA,uBAAiB,GAAE,CAAC;IAC1B,4BAAY,CAAC,KAAK,EAAE,CAAC;IACrB,MAAM,MAAM,GAAG,MAAM,mBAAQ,CAAC,SAAS,EAAE,CAAC;IAC1C,IACE,MAAM,EAAE,IAAI,CACV,CAAC,EAAE,EAAE,EAAE,CACL,EAAE,CAAC,KAAK,KAAK,QAAQ;QACrB,EAAE,CAAC,KAAK,KAAK,oBAAoB;QACjC,EAAE,CAAC,KAAK,KAAK,MAAM,CAAC,iBAAiB,CACxC,EACD;QACA,eAAM,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC;QAClC,MAAM,CAAC,eAAe,GAAG,IAAI,CAAC;KAC/B;IACD,IAAA,4CAAoB,EAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AACvC,CAAC;AAxBD,oCAwBC","sourcesContent":["import type { RenovateConfig } from '../../../config/types';\nimport { logger } from '../../../logger';\nimport { platform } from '../../../modules/platform';\nimport * as repositoryCache from '../../../util/cache/repository';\nimport { clearRenovateRefs } from '../../../util/git';\nimport { PackageFiles } from '../package-files';\nimport { pruneStaleBranches } from './prune';\nimport { runRenovateRepoStats } from './repository-statistics';\n\n// istanbul ignore next\nexport async function finaliseRepo(\n  config: RenovateConfig,\n  branchList: string[]\n): Promise<void> {\n  await repositoryCache.saveCache();\n  await pruneStaleBranches(config, branchList);\n  await platform.ensureIssueClosing(\n    `Action Required: Fix Renovate Configuration`\n  );\n  await clearRenovateRefs();\n  PackageFiles.clear();\n  const prList = await platform.getPrList();\n  if (\n    prList?.some(\n      (pr) =>\n        pr.state === 'merged' &&\n        pr.title !== 'Configure Renovate' &&\n        pr.title !== config.onboardingPrTitle\n    )\n  ) {\n    logger.debug('Repo is activated');\n    config.repoIsActivated = true;\n  }\n  runRenovateRepoStats(config, prList);\n}\n"]}